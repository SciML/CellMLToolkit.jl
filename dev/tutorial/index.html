<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · CellMLToolkit.jl</title><meta name="title" content="Tutorial · CellMLToolkit.jl"/><meta property="og:title" content="Tutorial · CellMLToolkit.jl"/><meta property="twitter:title" content="Tutorial · CellMLToolkit.jl"/><meta name="description" content="Documentation for CellMLToolkit.jl."/><meta property="og:description" content="Documentation for CellMLToolkit.jl."/><meta property="twitter:description" content="Documentation for CellMLToolkit.jl."/><meta property="og:url" content="https://docs.sciml.ai/CellMLToolkit/stable/tutorial/"/><meta property="twitter:url" content="https://docs.sciml.ai/CellMLToolkit/stable/tutorial/"/><link rel="canonical" href="https://docs.sciml.ai/CellMLToolkit/stable/tutorial/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="CellMLToolkit.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">CellMLToolkit.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Changing-Parameters"><span>Changing Parameters</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SciML/CellMLToolkit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SciML/CellMLToolkit.jl/blob/master/docs/src/tutorial.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><p>The models directory contains a few CellML model examples. Let&#39;s start with a simple one, the famous Lorenz equations!</p><pre><code class="language-Julia hljs">  using CellMLToolkit

  ml = CellModel(&quot;models/lorenz.cellml.xml&quot;)

  tspan = (0, 100.0)
  prob = ODEProblem(ml, tspan)</code></pre><p>Now, <code>ml</code> points to a <code>CellModel</code> struct that contains the details of the model, and <code>prob</code> is an <code>ODEProblem</code> ready for integration. We can solve and visualize <code>prob</code> as</p><pre><code class="language-Julia hljs">  using DifferentialEquations, Plots

  sol = solve(prob, TRBDF2(), dtmax=0.01)
  X = map(x -&gt; x[1], sol.u)
  Z = map(x -&gt; x[3], sol.u)
  plot(X, Z)</code></pre><p>As expected,</p><p><img src="../assets/lorenz.png" alt/></p><p>Let&#39;s look at more complicated examples. The next one is the <a href="https://journals.physiology.org/doi/full/10.1152/ajpheart.00794.2003">ten Tusscher-Noble-Noble-Panfilov human left ventricular action potential model</a>. This is a mid-range electrophysiology model with 17 state variables and relatively good numerical stability.</p><pre><code class="language-Julia hljs">  ml = CellModel(&quot;models/tentusscher_noble_noble_panfilov_2004_a.cellml.xml&quot;)
  tspan = (0, 5000.0)
  prob = ODEProblem(ml, tspan)
  sol = solve(prob, TRBDF2(), dtmax=1.0)
  V = map(x -&gt; x[1], sol.u)
  plot(sol.t, V)</code></pre><p><img src="../assets/ten.png" alt/></p><p>We can also enhance the model by asking ModelingToolkit.jl to generate a Jacobian by passing <code>jac=true</code> to the <code>ODEProblem</code> constructor.</p><pre><code class="language-Julia hljs">  prob = ODEProblem(ml, tspan; jac=true)  </code></pre><p>The rest remains the same. For the last example, we chose a complex model to stress the ODE solvers: <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1002061">the O&#39;Hara-Rudy left ventricular model</a>. This model has 49 state variables, is very stiff, and is prone to oscillation. The best solver for this model is <code>CVODE_BDF</code> from the Sundial suite.</p><pre><code class="language-Julia hljs">  ml = CellModel(&quot;models/ohara_rudy_cipa_v1_2017.cellml.xml&quot;)
  tspan = (0, 5000.0)
  prob = ODEProblem(ml, tspan);
  sol = solve(prob, CVODE_BDF(), dtmax=0.5)
  V = map(x -&gt; x[1], sol.u)
  plot(sol.t, V)</code></pre><p><img src="../assets/ohara_rudy.png" alt/></p><h2 id="Changing-Parameters"><a class="docs-heading-anchor" href="#Changing-Parameters">Changing Parameters</a><a id="Changing-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Changing-Parameters" title="Permalink"></a></h2><p>Up to this point, we have run the model exactly as provided by CellML. In practice, we need to be able to modify the model parameters (either the initial conditions or the proper parameters). CellMLToolkit has multiple utility functions that help us interrogate and modify the model parameters.</p><p>There are three <code>list</code> functions: <code>list_states</code>, <code>list_params</code>, and <code>list_initial_conditions</code>. <code>list_states</code> returns a list of the state variables, i.e., the variables present on the left side of an ODE. <code>list_params</code> and <code>list_initial_conditions</code> return arrays of (variable, value) pairs, providing the model parameters and the state variables initial conditions, respectively (corresponding to <code>p</code> and <code>u0</code> in DifferentialEquations.jl nomenclature).</p><p>Here, we are interested in <code>list_params</code>. Let&#39;s go back to the ten Tusscher-Noble-Noble-Panfilov model and list its params:</p><pre><code class="language-julia hljs">ml = CellModel(&quot;models/tentusscher_noble_noble_panfilov_2004_a.cellml.xml&quot;)
p = list_params(ml)
display(p)</code></pre><p>We get a list of the 45 parameters:</p><pre><code class="nohighlight hljs">45-element Array{Pair{Operation,Float64},1}:
 stim_start =&gt; 10.0
       g_pK =&gt; 0.0146
      g_bna =&gt; 0.00029
      K_mNa =&gt; 40.0
      b_rel =&gt; 0.25
       g_Ks =&gt; 0.062
      K_pCa =&gt; 0.0005
       g_Kr =&gt; 0.096
       Na_o =&gt; 140.0
       K_up =&gt; 0.00025
            ⋮</code></pre><p>To modify a parameter, we use <code>update_list!</code> function. For example, the following code changes the stimulation period (<code>stim_period</code>) from its default of 1000 ms to 400 ms</p><pre><code class="language-julia hljs">update_list!(p, &quot;stim_period&quot;, 400.0)</code></pre><p>We need to pass the new <code>p</code> to <code>ODEProblem</code> constructor as a keyword parameter. The rest of the code remains the same.</p><pre><code class="language-julia hljs">tspan = (0, 5000.0)
prob = ODEProblem(ml, tspan; p = p)
sol = solve(prob, TRBDF2(), dtmax = 1.0)
V = map(x -&gt; x[1], sol.u)
plot(sol.t, V)</code></pre><p><img src="../assets/ten_400.png" alt/></p><p><code>ODEProblem</code> also accepts a <code>u0</code> parameter to change the initial conditions (remember <code>u0 = list_initial_conditions(ml)</code>).</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.1 on <span class="colophon-date" title="Friday 11 April 2025 08:57">Friday 11 April 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
